# 数据采集功能建设方案

## 一、数据采集功能块规划

数据采集

* 采集任务信息页
* 新建采集任务
  * 配置采集任务信息
    * 选择类别
      * 批量数据采集
      * 实时数据采集
      * 接口采集
    * 配置参数
      * 采集源
      * 采集能力
      * 采集频率
      * 筛选条件
      * 配置输出目的地
      * ...
* 采集任务列表页
* 采集任务管理
  * 查看详情
  * 修改任务信息
  * 删除任务
  * 重启
  * 停止

## 数据采集技术实现方案

先基于flume来初步构建数据采集模块的功能，结合上面功能上的规划，这里具体实现方案思路如下

**选择类别**可能对应flume的source

### 批量数据采集（非结化数据文件、图片等）

基于flume的批量数据采集，这里可能涉及到的source有

* exec source
* http source
* syslog source
* taildir source

### 实时数据采集

基于flume的实时数据采集，这里可能涉及到的source有

* netcat tcp 
* netcat udp 
* syslog tcp 
* multiport syslog
* syslog udp 
* avro legacy 
* thrift source
* kafka source 

### 接口数据采集

java or python 程序



## 其它可能所需的技术

创建和管理采集任务的技术逻辑大致是：

1. 通过点击选择，生成相应的配置文件
2. 配置文件从前端发送至web后端服务器
3. web服务器生成执行语句
4. web服务器选择要执行的flume主机，并建立连接
5. flume主机接收到执行语句，并执行相关命令
6. web后端服务器接收执行结果

java 建立ssh连接用到 JSch



![CleanShot 2022-02-17 at 16.55.14@2x](http://img.wqkenqing.ren/typora_img/CleanShot%202022-02-17%20at%2016.55.14@2x.png)

## 二、数据采集实现细节说明

![CleanShot 2022-02-22 at 14.04.20@2x](http://img.wqkenqing.ren/typora_img/CleanShot%202022-02-22%20at%2014.04.20@2x.png)

### **任务类型** 

| 类型名    |      说明       |
| --------- | :-------------: |
| TCP       |     tcp采集     |
| UDP       |     udp采集     |
| kafka     |    kafka采集    |
| csv、txt  |    文本采集     |
| http      |    http采集     |
| mysql     | mysql数据库采集 |
| websocket |  websocket采集  |
| sqlserver |  sqlserver采集  |



#### 不同类型所需要的参数

|   类型    |                       参数(*是必填)                        | 补充 |
| :-------: | :--------------------------------------------------------: | ---- |
| TCP、UDP  |              ip/host(*)、port (*)、agentName               |      |
|   kafka   | bootstrap_server、port、topics、consumer_group 、agentName |      |
| csv、txt  |                      file、agentName                       |      |
|   http    |                     address、taskName                      |      |
|   msyql   |                     后续确认、taskName                     |      |
| websocket |                     后续确认、taskName                     |      |
| sqlserver |                     后续确认、taskName                     |      |




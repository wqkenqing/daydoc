title: 大数据组件升级改造 
date: 2023-10-31 15:59:03 
tags: []
categories: [运维]
password: 7FKBKZrTTTPG2LnC

---
 <!--more-->
## 组件安全升级

> 洪雅项目发生了elaticsearch被黑客入侵事故，事后分析，主要跟我们内部安全策略不强也有关系，接下来对相关组件进行安全升级

 

### 1 问题分析

1.1 因为elasticsearch默认是9200、9300的端口开放，且默认是没有加安全组件的，我们的移动云服务器，虽然并未将相应端口外部暴露，如果是移动云内部，仍可能发生被扫描的爆破

### 问题解决

1. 加xpack安全组件
2. 加防火墙策略
   1. 只允许内部服务器访问
3. 升级es从6.7到6.8







```
我现在需要对部署在ubuntu上的elasticsearch服务进行端口防火墙策略，现在需要实现的策略是只允许
192.168.18.100 namenode
192.168.18.104 namenode2
192.168.18.101 datanode1
192.168.18.102 datanode2
192.168.18.103 datanode3
这几台服务器之前可以访问9200、9300端口

```

```
# 允许192.168.18.100访问9200端口
sudo ufw allow from 192.168.18.100 to any port 9200

# 允许192.168.18.100访问9300端口
sudo ufw allow from 192.168.18.100 to any port 9300

# 允许192.168.18.104访问9200端口
sudo ufw allow from 192.168.18.104 to any port 9200

# 允许192.168.18.104访问9300端口
sudo ufw allow from 192.168.18.104 to any port 9300

# 允许192.168.18.101访问9200端口
sudo ufw allow from 192.168.18.101 to any port 9200

# 允许192.168.18.101访问9300端口
sudo ufw allow from 192.168.18.101 to any port 9300

# 允许192.168.18.102访问9200端口
sudo ufw allow from 192.168.18.102 to any port 9200

# 允许192.168.18.102访问9300端口
sudo ufw allow from 192.168.18.102 to any port 9300

# 允许192.168.18.103访问9200端口
sudo ufw allow from 192.168.18.103 to any port 9200

# 允许192.168.18.103访问9300端口
sudo ufw allow from 192.168.18.103 to any port 9300


sudo ufw allow from 192.168.9.185 to any port 9200

```

centos



```
# 添加允许192.168.18.100访问9200端口的规则
sudo firewall-cmd --permanent --zone=public --add-rich-rule='rule family=ipv4 source address=192.168.18.100 port port=9200 protocol=tcp accept'

# 添加允许192.168.18.100访问9300端口的规则
sudo firewall-cmd --permanent --zone=public --add-rich-rule='rule family=ipv4 source address=192.168.18.100 port port=9300 protocol=tcp accept'

# 添加允许192.168.18.104访问9200端口的规则
sudo firewall-cmd --permanent --zone=public --add-rich-rule='rule family=ipv4 source address=192.168.18.104 port port=9200 protocol=tcp accept'

# 添加允许192.168.18.104访问9300端口的规则
sudo firewall-cmd --permanent --zone=public --add-rich-rule='rule family=ipv4 source address=192.168.18.104 port port=9300 protocol=tcp accept'

# 添加允许192.168.18.101访问9200端口的规则
sudo firewall-cmd --permanent --zone=public --add-rich-rule='rule family=ipv4 source address=192.168.18.101 port port=9200 protocol=tcp accept'

# 添加允许192.168.18.101访问9300端口的规则
sudo firewall-cmd --permanent --zone=public --add-rich-rule='rule family=ipv4 source address=192.168.18.101 port port=9300 protocol=tcp accept'

# 添加允许192.168.18.102访问9200端口的规则
sudo firewall-cmd --permanent --zone=public --add-rich-rule='rule family=ipv4 source address=192.168.18.102 port port=9200 protocol=tcp accept'

# 添加允许192.168.18.102访问9300端口的规则
sudo firewall-cmd --permanent --zone=public --add-rich-rule='rule family=ipv4 source address=192.168.18.102 port port=9300 protocol=tcp accept'

# 添加允许192.168.18.103访问9200端口的规则
sudo firewall-cmd --permanent --zone=public --add-rich-rule='rule family=ipv4 source address=192.168.18.103 port port=9200 protocol=tcp accept'

# 添加允许192.168.18.103访问9300端口的规则
sudo firewall-cmd --permanent --zone=public --add-rich-rule='rule family=ipv4 source address=192.168.18.103 port port=9300 protocol=tcp accept'

```

```
sudo firewall-cmd --reload
```

```
curl -X GET "http://namenode2:9200/_cat/indices?v"

```


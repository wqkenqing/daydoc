<!DOCTYPE html>
<html lang="zh-Hans">

<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
<meta name="x5-fullscreen" content="true">
<meta name="full-screen" content="yes">
<meta name="theme-color" content="#317EFB" />
<meta content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=0" name="viewport">
<meta name="description" content="前面中梳理了hive的DML、DQL等基础用法。本文主要掌握运算符与函数等相关内容。   内置运算符关系运算符关系运算符是二元运算符，执行的是两个操作数的比较运算。每个关系运算符都返回boolean类型结果（TRUE或FALSE）。 1234567891011等值比较: &#x3D; 、&#x3D;&#x3D;•不等值比较: &lt;&gt; 、!&#x3D;•小于比较: &lt;•小于等于比较: &lt;&#x3D;•大于比较: &amp;gt">
<meta property="og:type" content="article">
<meta property="og:title" content="hive梳理2">
<meta property="og:url" content="http://www.wqkenqing.ren/daydoc/2023/10/31/%E7%8E%8B%E9%98%81/%E5%9B%9E%E9%A1%BE/hive/hive%E6%A2%B3%E7%90%862/index.html">
<meta property="og:site_name" content="wang&#39;s dayliy document">
<meta property="og:description" content="前面中梳理了hive的DML、DQL等基础用法。本文主要掌握运算符与函数等相关内容。   内置运算符关系运算符关系运算符是二元运算符，执行的是两个操作数的比较运算。每个关系运算符都返回boolean类型结果（TRUE或FALSE）。 1234567891011等值比较: &#x3D; 、&#x3D;&#x3D;•不等值比较: &lt;&gt; 、!&#x3D;•小于比较: &lt;•小于等于比较: &lt;&#x3D;•大于比较: &amp;gt">
<meta property="og:locale">
<meta property="og:image" content="http://www.wqkenqing.ren/daydoc/img/404.jpg">
<meta property="article:published_time" content="2023-10-31T01:49:59.000Z">
<meta property="article:modified_time" content="2023-11-01T05:52:32.913Z">
<meta property="article:author" content="Kuiq  Wang">
<meta property="article:tag" content="yGin910">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://www.wqkenqing.ren/daydoc/img/404.jpg">

    <meta name="keywords" content="yGin910">


<title >hive梳理2</title>

<!-- Favicon -->

    <link href='/daydoc/img/favicon.svg?v=2.1.6' rel='icon' type='image/png' sizes='16x16' ></link>


    <link href='/daydoc/img/favicon.svg?v=2.1.6' rel='icon' type='image/png' sizes='32x32' ></link>




<!-- Plugin -->




    
<link rel="stylesheet" href="/daydoc/css/plugins/bootstrap.row.css">

    
<link rel="stylesheet" href="https://unpkg.com/@fancyapps/ui@4.0/dist/fancybox.css">

    
    




<!-- Icon -->

    
<link rel="stylesheet" href="/daydoc/css/plugins/font-awesome.min.css">




<!-- Variable -->
<script>window.ASYNC_CONFIG = {"hostname":"www.wqkenqing.ren","author":"Kuiq  Wang","root":"/daydoc/","typed_text":["Data Developer"],"theme_version":"2.1.6","theme":{"switch":true,"default":"style-light"},"favicon":{"logo":"/img/favicon.svg","icon16":"/img/favicon.svg","icon32":"/img/favicon.svg","appleTouchIcon":null,"webmanifest":null,"visibilitychange":false,"hidden":"/failure.ico","showText":"(/≧▽≦/)咦！又好了！","hideText":"(●—●)喔哟，崩溃啦！"},"i18n":{"placeholder":"搜索文章...","empty":"找不到您查询的内容: ${query}","hits":"找到 ${hits} 条结果","hits_time":"找到 ${hits} 条结果（用时 ${time} 毫秒）","author":"本文作者：","copyright_link":"本文链接：","copyright_license_title":"版权声明：","copyright_license_content":"本博客所有文章除特别声明外，均默认采用 undefined 许可协议。","copy_success":"复制成功","copy_failure":"复制失败","open_read_mode":"进入阅读模式","exit_read_mode":"退出阅读模式","notice_outdate_message":"距离上次更新已经 undefined 天了, 文章内容可能已经过时。","sticky":"置顶","just":"刚刚","min":"分钟前","hour":"小时前","day":"天前","month":"个月前"},"swup":false,"plugin":{"flickr_justified_gallery":"https://unpkg.com/flickr-justified-gallery@latest/dist/fjGallery.min.js"},"icons":{"sun":"far fa-sun","moon":"far fa-moon","play":"fas fa-play","email":"far fa-envelope","next":"fas fa-arrow-right","calendar":"far fa-calendar-alt","clock":"far fa-clock","user":"far fa-user","back_top":"fas fa-arrow-up","close":"fas fa-times","search":"fas fa-search","reward":"fas fa-hand-holding-usd","user_tag":"fas fa-user-alt","toc_tag":"fas fa-th-list","read":"fas fa-book-reader","arrows":"fas fa-arrows-alt-h","double_arrows":"fas fa-angle-double-down","copy":"fas fa-copy"},"icontype":"font","highlight":{"plugin":"highlighjs","theme":true,"copy":true,"lang":true,"title":"default","height_limit":false},"toc":{"post_title":false},"covers":["https://cdn.pixabay.com/photo/2023/09/18/16/47/leaves-8260967_1280.jpg","https://cdn.pixabay.com/photo/2022/10/28/12/05/halloween-7553022_1280.jpg","https://pixabay.com/link/?ua=cd3%3Dimage%26cd7%3Den%253Anature%253AFRA%26ec%3Dapi_ad%26ea%3Dnavigate%26el%3Dgetty%26tid%3DUA-20223345-1%26dr%3Dhttps%253A%252F%252Fpixabay.com%252Fzh%252F&sp=%2524%3Dadvertisement_clicked%26media_type%3Dimage%26user_action%3Dnavigate%26ad_partner%3Dgetty%26ad_content%3Dapi_ad&next=https%3A%2F%2Fwww.istockphoto.com%2Fphoto%2Fhand-holdig-plant-growing-on-green-background-with-sunshine-gm1394781347-450126535%3Futm_source%3Dpixabay%26utm_medium%3Daffiliate%26utm_campaign%3DSRP_image_sponsored%26utm_content%3Dhttps%253A%252F%252Fpixabay.com%252Fzh%252Fimages%252Fsearch%252F%253Forder%253Dec%26utm_term%3Dnature&hash=83a731925a44749a062f73923a53e8e21a4c6a24&=","https://pixabay.com/zh/photos/eagle-bird-raptor-animal-show-8319555/","https://cdn.pixabay.com/photo/2023/10/13/16/39/coffee-8313090_1280.jpg","https://cdn.pixabay.com/photo/2023/10/21/11/46/sunset-8331285_1280.jpg","https://media.istockphoto.com/id/1225941556/fr/photo/caf%C3%A9-faire-du-caf%C3%A9-de-la-machine-%C3%A0-la-maison.jpg?s=2048x2048&w=is&k=20&c=kdUMGRbdkXVZKYr71E_iEC4tYTDFUWpsbeOcOIOHkUY="]};</script>
<script id="async-page-config">window.PAGE_CONFIG = {"isPost":true,"isHome":false,"postUpdate":"2023-11-01 13:52:32"};</script>

<!-- Theme mode css -->
<link data-swup-theme rel="stylesheet" href="/daydoc/css/index.css?v=2.1.6" id="trm-switch-style">
<script>
    let defaultMode = ASYNC_CONFIG.theme.default !=='auto' ?  ASYNC_CONFIG.theme.default : (window.matchMedia("(prefers-color-scheme: light)").matches ? 'style-light' : 'style-dark')
    let catchMode = localStorage.getItem('theme-mode') || defaultMode;
    let type = catchMode === 'style-dark' ? 'add' : 'remove';
    document.documentElement.classList[type]('dark')
</script>

<!-- CDN -->


    
    



<!-- Site Analytics -->
 
<meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/daydoc/atom.xml" title="wang's dayliy document" type="application/atom+xml">
</head>

<body>

  <!-- app wrapper -->
  <div class="trm-app-frame">

    <!-- page preloader -->
    <div class="trm-preloader">
    <div class="trm-holder">
        <div class="preloader">
            <div></div>
            <div></div>
            <div></div>
            <div></div>
            <div></div>
            <div></div>
            <div></div>
            <div></div>
            <div></div>
            <div></div>
        </div>
    </div>
</div>
    <!-- page preloader end -->

    <!-- change mode preloader -->
    <div class="trm-mode-swich-animation-frame">
    <div class="trm-mode-swich-animation">
        <i class="i-sun"><i class="iconfont far fa-sun"></i></i>
        <div class="trm-horizon"></div>
        <i class="i-moon"><i class="iconfont far fa-moon"></i></i>
    </div>
</div>
    <!-- change mode preloader end -->

      <!-- scroll container -->
      <div id="trm-dynamic-content" class="trm-swup-animation">
        <div id="trm-scroll-container" class="trm-scroll-container" style="opacity: 0">
            <!-- top bar -->
            <header class="trm-top-bar">
	<div class="container">
		<div class="trm-left-side">
			<!-- logo -->
<a href="/daydoc/" class="trm-logo-frame trm-anima-link">
    
        <img alt="logo" src="/daydoc/img/favicon.svg">
    
    
        <div class="trm-logo-text">
            人从<span>两</span>
        </div>
    
</a>
<!-- logo end -->
		</div>
		<div class="trm-right-side">
			<!-- menu -->
<div class="trm-menu">
    <nav>
        <ul>
            
            <li class="menu-item-has-children ">
                <a  href="/daydoc/" target="">
                    首页
                </a>
                
            </li>
            
            <li class="menu-item-has-children ">
                <a  href="/daydoc/archives/" target="">
                    归档
                </a>
                
            </li>
            
        </ul>
    </nav>
</div>
<!-- menu end -->
			
    <!-- mode switcher place -->
    <div class="trm-mode-switcher-place">
        <div class="trm-mode-switcher">
            <i class="iconfont far fa-sun"></i>
            <input class="tgl tgl-light" id="trm-swich" type="checkbox">
            <label class="trm-swich" for="trm-swich"></label>
            <i class="iconfont far fa-moon"></i>
        </div>
    </div>
    <!-- mode switcher place end -->

			
		</div>
		<div class="trm-menu-btn">
			<span></span>
		</div>
	</div>
</header>
            <!-- top bar end -->

            <!-- body -->
            
<div class="trm-content-start">
    <!-- banner -->
    <div class="trm-banner">
    
    <!-- banner cover -->
    <img style="object-position:top;object-fit:cover;" alt="banner" class="trm-banner-cover" src="/daydoc/img/banner.png">
    <!-- banner cover end -->
    

    <!-- banner content -->
    <div class="trm-banner-content trm-overlay">
        <div class="container">
            <div class="row">
                
                <div class="col-lg-4"></div>
                
                <div class="col-lg-8">

                    <!-- banner title -->
                    <div class="trm-banner-text ">
                        <div class="trm-label trm-mb-20">
                            NEWS LETTER
                        </div>
                        <h1 class="trm-mb-30 trm-hsmb-font">
                            hive梳理2
                        </h1>

                        
                            <ul class="trm-breadcrumbs trm-label">
                                <li>
                                    <a href="/daydoc/" class="trm-anima-link">Home</a>
                                </li>
                                <li>
                                    <span>
                                        2023
                                    </span>
                                </li>
                            </ul>
                        
                    </div>
                    <!-- banner title end -->

                    <!-- scroll hint -->
                    <span id="scroll-triger" class="trm-scroll-hint-frame">
                        <div class="trm-scroll-hint"></div>
                        <span class="trm-label">Scroll down</span>
                    </span>
                    <!-- scroll hint end -->

                </div>
            </div>
        </div>
    </div>
    <!-- banner content end -->
</div>
    <!-- banner end -->
    <div class="container">
        <div class="row">
            
                <div class="trm-page-sidebar col-lg-4 hidden-sm">
                    <!-- main card -->
                    <div class="trm-main-card-frame trm-sidebar">
    <div class="trm-main-card"> 
        <!-- card header -->
<div class="trm-mc-header">
    <div class="trm-avatar-frame trm-mb-20">
        <img alt="Avatar" class="trm-avatar" src="https://pic.616pic.com/ys_bnew_img/00/04/31/yUPTAXjSKA.jpg">
    </div>
    <h5 class="trm-name trm-mb-15">
        两人从
    </h5>
    
        <div class="trm-label">
            I`m
            <span class="trm-typed-text">
                <!-- Words for theme.user.typedText -->
            </span>
        </div>
    
</div>
<!-- card header end -->
        <!-- sidebar social -->

<div class="trm-divider trm-mb-40 trm-mt-40"></div>
<div class="trm-social">
    
        <a href="https://github.com" title="Github" rel="nofollow" target="_blank">
            <i class="iconfont fab fa-github"></i>
        </a>
    
</div>

<!-- sidebar social end -->
        <!-- info -->
<div class="trm-divider trm-mb-40 trm-mt-40"></div>
<ul class="trm-table trm-mb-20">
    
        <li>
            <div class="trm-label">
                Residence:
            </div>
            <div class="trm-label trm-label-light">
                Mars
            </div>
        </li>
    
</ul>
<!-- info end -->

        
    <div class="trm-divider trm-mb-40 trm-mt-40"></div>
    <!-- action button -->
    <div class="text-center">
        <a href="mailto:wqkenqingto@163.com" class="trm-btn">
            联系我
            <i class="iconfont far fa-envelope"></i>
        </a>
    </div>
    <!-- action button end -->

    </div>
</div>
                    <!-- main card end -->
                </div>
            
            <div class="trm-page-content col-lg-8">
                <div id="trm-content" class="trm-content">
                    <div class="trm-post-info row hidden-sm">
    <div class="col-sm-4">
        <div class="trm-card trm-label trm-label-light text-center">
            <i class="iconfont far fa-calendar-alt trm-icon"></i><br>
            10/31
        </div>
    </div>
    <div class="col-sm-4">
        <div class="trm-card trm-label trm-label-light text-center">
            <i class="iconfont far fa-clock trm-icon"></i><br>
            09:49
        </div>
    </div>
    <div class="col-sm-4">
        <div id="post-author" class="trm-card trm-label trm-label-light text-center">
            <i class="iconfont far fa-user trm-icon"></i><br>
            Kuiq  Wang
        </div>
    </div>
</div>
<div class="trm-card ">
    <article id="article-container" class="trm-publication">
     <span id="more"></span>

<blockquote>
<p>前面中梳理了hive的DML、DQL等基础用法。本文主要掌握运算符与函数等相关内容。 </p>
</blockquote>
<h2 id="内置运算符"><a href="#内置运算符" class="headerlink" title="内置运算符"></a>内置运算符</h2><h3 id="关系运算符"><a href="#关系运算符" class="headerlink" title="关系运算符"></a>关系运算符</h3><p><strong>关系运算符</strong>是二元运算符，执行的是两个操作数的比较运算。每个关系运算符都返回boolean类型结果（TRUE或FALSE）。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">等值比较: = 、==</span><br><span class="line">•不等值比较: &lt;&gt; 、!=</span><br><span class="line">•小于比较: &lt;</span><br><span class="line">•小于等于比较: &lt;=</span><br><span class="line">•大于比较: &gt;</span><br><span class="line">•大于等于比较: &gt;=</span><br><span class="line">•空值判断: IS NULL </span><br><span class="line">•非空判断: IS NOT NULL</span><br><span class="line">•LIKE比较: LIKE</span><br><span class="line">•JAVA的LIKE操作: RLIKE</span><br><span class="line">•REGEXP操作: REGEXP</span><br></pre></td></tr></table></figure>

<h3 id="算术运算符"><a href="#算术运算符" class="headerlink" title="算术运算符"></a><strong>算术运算符</strong></h3><p>算术运算符操作数必须是数值类型。 分为一元运算符和二元运算符; 一元运算符,只有一个操作数; 二元运算符有两个操作数,运算符在两个操作数之间。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">•加法操作: +</span><br><span class="line">•减法操作: -</span><br><span class="line">•乘法操作: *</span><br><span class="line">•除法操作: /</span><br><span class="line">•取整操作: div</span><br><span class="line">•取余操作: %</span><br><span class="line">•位与操作: &amp;</span><br><span class="line">•位或操作: |</span><br><span class="line">•位异或操作: ^</span><br><span class="line">•位取反操作: ~</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">--取整操作: div  给出将A除以B所得的整数部分。例如17 div 3得出5。</span><br><span class="line">select 17 div 3;</span><br><span class="line"></span><br><span class="line">--取余操作: %  也叫做取模  A除以B所得的余数部分</span><br><span class="line">select 17 % 3;</span><br><span class="line"></span><br><span class="line">--位与操作: &amp;  A和B按位进行与操作的结果。 与表示两个都为1则结果为1</span><br><span class="line">select 4 &amp; 8 from dual;  --4转换二进制：0100 8转换二进制：1000</span><br><span class="line">select 6 &amp; 4 from dual;  --4转换二进制：0100 6转换二进制：0110</span><br><span class="line"></span><br><span class="line">--位或操作: |  A和B按位进行或操作的结果  或表示有一个为1则结果为1</span><br><span class="line">select 4 | 8 from dual;</span><br><span class="line">select 6 | 4 from dual;</span><br><span class="line"></span><br><span class="line">--位异或操作: ^ A和B按位进行异或操作的结果 异或表示两个不同则结果为1</span><br><span class="line">select 4 ^ 8 from dual;</span><br><span class="line">select 6 ^ 4 from dual;</span><br></pre></td></tr></table></figure>

<h3 id="逻辑运算符"><a href="#逻辑运算符" class="headerlink" title="逻辑运算符"></a>逻辑运算符</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">•与操作: A AND B</span><br><span class="line">•或操作: A OR B</span><br><span class="line">•非操作: NOT A 、!A</span><br><span class="line">•在:A IN (val1, val2, ...)</span><br><span class="line">•不在:A NOT IN (val1, val2, ...)	</span><br><span class="line">•逻辑是否存在: [NOT] EXISTS (subquery)</span><br></pre></td></tr></table></figure>

<h2 id="Hive函数"><a href="#Hive函数" class="headerlink" title="Hive函数"></a>Hive函数</h2><h3 id="内置函数"><a href="#内置函数" class="headerlink" title="内置函数"></a>内置函数</h3><p>内置函数主要有八大类</p>
<h4 id="String-Functions-字符串函数"><a href="#String-Functions-字符串函数" class="headerlink" title="String Functions 字符串函数"></a><strong>String Functions 字符串函数</strong></h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">字符串长度函数：length</span><br><span class="line">•字符串反转函数：reverse</span><br><span class="line">•字符串连接函数：concat</span><br><span class="line">•带分隔符字符串连接函数：concat_ws</span><br><span class="line">•字符串截取函数：substr,substring</span><br><span class="line">•字符串转大写函数：upper,ucase</span><br><span class="line">•字符串转小写函数：lower,lcase</span><br><span class="line">•去空格函数：trim</span><br><span class="line">•左边去空格函数：ltrim</span><br><span class="line">•右边去空格函数：rtrim</span><br><span class="line">•正则表达式替换函数：regexp_replace</span><br><span class="line">•正则表达式解析函数：regexp_extract</span><br><span class="line">•URL解析函数：parse_url</span><br><span class="line">•json解析函数：get_json_object</span><br><span class="line">•空格字符串函数：space</span><br><span class="line">•重复字符串函数：repeat</span><br><span class="line">•首字符ascii函数：ascii</span><br><span class="line">•左补足函数：lpad</span><br><span class="line">•右补足函数：rpad</span><br><span class="line">•分割字符串函数: split</span><br><span class="line">•集合查找函数: find_in_set</span><br></pre></td></tr></table></figure>

<p>示例</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line">------------String Functions 字符串函数------------</span><br><span class="line">describe function extended find_in_set;</span><br><span class="line"></span><br><span class="line">--字符串长度函数：length(str | binary)</span><br><span class="line">select length(&quot;angelababy&quot;);</span><br><span class="line"></span><br><span class="line">--字符串反转函数：reverse</span><br><span class="line">select reverse(&quot;angelababy&quot;);</span><br><span class="line"></span><br><span class="line">--字符串连接函数：concat(str1, str2, ... strN)</span><br><span class="line">select concat(&quot;angela&quot;,&quot;baby&quot;);</span><br><span class="line"></span><br><span class="line">--带分隔符字符串连接函数：concat_ws(separator, [string | array(string)]+)</span><br><span class="line">select concat_ws(&#x27;.&#x27;, &#x27;www&#x27;, array(&#x27;itcast&#x27;, &#x27;cn&#x27;));</span><br><span class="line"></span><br><span class="line">--字符串截取函数：substr(str, pos[, len]) 或者  substring(str, pos[, len])</span><br><span class="line">select substr(&quot;angelababy&quot;,-2); --pos是从1开始的索引，如果为负数则倒着数</span><br><span class="line">select substr(&quot;angelababy&quot;,2,2);</span><br><span class="line"></span><br><span class="line">--字符串转大写函数：upper,ucase</span><br><span class="line">select upper(&quot;angelababy&quot;);</span><br><span class="line">select ucase(&quot;angelababy&quot;);</span><br><span class="line"></span><br><span class="line">--字符串转小写函数：lower,lcase</span><br><span class="line">select lower(&quot;ANGELABABY&quot;);</span><br><span class="line">select lcase(&quot;ANGELABABY&quot;);</span><br><span class="line"></span><br><span class="line">--去空格函数：trim 去除左右两边的空格</span><br><span class="line">select trim(&quot; angelababy &quot;);</span><br><span class="line"></span><br><span class="line">--左边去空格函数：ltrim</span><br><span class="line">select ltrim(&quot; angelababy &quot;);</span><br><span class="line"></span><br><span class="line">--右边去空格函数：rtrim</span><br><span class="line">select rtrim(&quot; angelababy &quot;);</span><br><span class="line"></span><br><span class="line">--正则表达式替换函数：regexp_replace(str, regexp, rep)</span><br><span class="line">select regexp_replace(&#x27;100-200&#x27;, &#x27;(\\d+)&#x27;, &#x27;num&#x27;);</span><br><span class="line"></span><br><span class="line">--正则表达式解析函数：regexp_extract(str, regexp[, idx]) 提取正则匹配到的指定组内容</span><br><span class="line">select regexp_extract(&#x27;100-200&#x27;, &#x27;(\\d+)-(\\d+)&#x27;, 2);</span><br><span class="line"></span><br><span class="line">--URL解析函数：parse_url 注意要想一次解析出多个 可以使用parse_url_tuple这个UDTF函数</span><br><span class="line">select parse_url(&#x27;http://www.itcast.cn/path/p1.php?query=1&#x27;, &#x27;HOST&#x27;);</span><br><span class="line"></span><br><span class="line">--json解析函数：get_json_object</span><br><span class="line">--空格字符串函数：space(n) 返回指定个数空格</span><br><span class="line">select space(4);</span><br><span class="line"></span><br><span class="line">--重复字符串函数：repeat(str, n) 重复str字符串n次</span><br><span class="line">select repeat(&quot;angela&quot;,2);</span><br><span class="line"></span><br><span class="line">--首字符ascii函数：ascii</span><br><span class="line">select ascii(&quot;angela&quot;);  --a对应ASCII 97</span><br><span class="line"></span><br><span class="line">--左补足函数：lpad</span><br><span class="line">select lpad(&#x27;hi&#x27;, 5, &#x27;??&#x27;);  --???hi</span><br><span class="line">select lpad(&#x27;hi&#x27;, 1, &#x27;??&#x27;);  --h</span><br><span class="line"></span><br><span class="line">--右补足函数：rpad</span><br><span class="line">select rpad(&#x27;hi&#x27;, 5, &#x27;??&#x27;);</span><br><span class="line"></span><br><span class="line">--分割字符串函数: split(str, regex)</span><br><span class="line">select split(&#x27;apache hive&#x27;, &#x27;\\s+&#x27;);</span><br><span class="line"></span><br><span class="line">--集合查找函数: find_in_set(str,str_array)</span><br><span class="line">select find_in_set(&#x27;a&#x27;,&#x27;abc,b,ab,c,def&#x27;);</span><br></pre></td></tr></table></figure>

<h4 id="Date-Functions-日期函数"><a href="#Date-Functions-日期函数" class="headerlink" title="Date Functions 日期函数"></a><strong>Date Functions 日期函数</strong></h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">获取当前日期: current_date</span><br><span class="line">•获取当前时间戳: current_timestamp</span><br><span class="line">•UNIX时间戳转日期函数: from_unixtime</span><br><span class="line">•获取当前UNIX时间戳函数: unix_timestamp</span><br><span class="line">•日期转UNIX时间戳函数: unix_timestamp</span><br><span class="line">•指定格式日期转UNIX时间戳函数: unix_timestamp</span><br><span class="line">•抽取日期函数: to_date</span><br><span class="line">•日期转年函数: year</span><br><span class="line">•日期转月函数: month</span><br><span class="line">•日期转天函数: day</span><br><span class="line">•日期转小时函数: hour</span><br><span class="line">•日期转分钟函数: minute</span><br><span class="line">•日期转秒函数: second</span><br><span class="line">•日期转周函数: weekofyear</span><br><span class="line">•日期比较函数: datediff</span><br><span class="line">•日期增加函数: date_add</span><br><span class="line">•日期减少函数: date_sub</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">--获取当前日期: current_date</span><br><span class="line">select current_date();</span><br><span class="line"></span><br><span class="line">--获取当前时间戳: current_timestamp</span><br><span class="line">--同一查询中对current_timestamp的所有调用均返回相同的值。</span><br><span class="line">select current_timestamp();</span><br><span class="line"></span><br><span class="line">--获取当前UNIX时间戳函数: unix_timestamp</span><br><span class="line">select unix_timestamp();</span><br><span class="line"></span><br><span class="line">--UNIX时间戳转日期函数: from_unixtime</span><br><span class="line">select from_unixtime(1618238391);</span><br><span class="line">select from_unixtime(0, &#x27;yyyy-MM-dd HH:mm:ss&#x27;);</span><br><span class="line"></span><br><span class="line">--日期转UNIX时间戳函数: unix_timestamp</span><br><span class="line">select unix_timestamp(&quot;2011-12-07 13:01:03&quot;);</span><br><span class="line"></span><br><span class="line">--指定格式日期转UNIX时间戳函数: unix_timestamp</span><br><span class="line">select unix_timestamp(&#x27;20111207 13:01:03&#x27;,&#x27;yyyyMMdd HH:mm:ss&#x27;);</span><br><span class="line"></span><br><span class="line">--抽取日期函数: to_date</span><br><span class="line">select to_date(&#x27;2009-07-30 04:17:52&#x27;);</span><br><span class="line"></span><br><span class="line">--日期转年函数: year</span><br><span class="line">select year(&#x27;2009-07-30 04:17:52&#x27;);</span><br><span class="line"></span><br><span class="line">--日期转月函数: month</span><br><span class="line">select month(&#x27;2009-07-30 04:17:52&#x27;);</span><br><span class="line"></span><br><span class="line">--日期转天函数: day</span><br><span class="line">select day(&#x27;2009-07-30 04:17:52&#x27;);</span><br><span class="line"></span><br><span class="line">--日期转小时函数: hour</span><br><span class="line">select hour(&#x27;2009-07-30 04:17:52&#x27;);</span><br><span class="line"></span><br><span class="line">--日期转分钟函数: minute</span><br><span class="line">select minute(&#x27;2009-07-30 04:17:52&#x27;);</span><br><span class="line"></span><br><span class="line">--日期转秒函数: second</span><br><span class="line">select second(&#x27;2009-07-30 04:17:52&#x27;);</span><br><span class="line"></span><br><span class="line">--日期转周函数: weekofyear 返回指定日期所示年份第几周</span><br><span class="line">select weekofyear(&#x27;2009-07-30 04:17:52&#x27;);</span><br><span class="line"></span><br><span class="line">--日期比较函数: datediff  日期格式要求&#x27;yyyy-MM-dd HH:mm:ss&#x27; or &#x27;yyyy-MM-dd&#x27;</span><br><span class="line">select datediff(&#x27;2012-12-08&#x27;,&#x27;2012-05-09&#x27;);</span><br><span class="line"></span><br><span class="line">--日期增加函数: date_add</span><br><span class="line">select date_add(&#x27;2012-02-28&#x27;,10);</span><br><span class="line"></span><br><span class="line">--日期减少函数: date_sub</span><br><span class="line">select date_sub(&#x27;2012-01-1&#x27;,10);</span><br></pre></td></tr></table></figure>

<h4 id="Mathematical-Functions-数学函数"><a href="#Mathematical-Functions-数学函数" class="headerlink" title="Mathematical Functions 数学函数"></a><strong>Mathematical Functions 数学函数</strong></h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">取整函数: round</span><br><span class="line">•指定精度取整函数: round</span><br><span class="line">•向下取整函数: floor</span><br><span class="line">•向上取整函数: ceil</span><br><span class="line">•取随机数函数: rand</span><br><span class="line">•二进制函数: bin</span><br><span class="line">•进制转换函数: conv</span><br><span class="line">•绝对值函数: abs</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">--取整函数: round  返回double类型的整数值部分 （遵循四舍五入）</span><br><span class="line">select round(3.1415926);</span><br><span class="line"></span><br><span class="line">--指定精度取整函数: round(double a, int d) 返回指定精度d的double类型</span><br><span class="line">select round(3.1415926,4);</span><br><span class="line"></span><br><span class="line">--向下取整函数: floor</span><br><span class="line">select floor(3.1415926);</span><br><span class="line">select floor(-3.1415926);</span><br><span class="line"></span><br><span class="line">--向上取整函数: ceil</span><br><span class="line">select ceil(3.1415926);</span><br><span class="line">select ceil(-3.1415926);</span><br><span class="line"></span><br><span class="line">--取随机数函数: rand 每次执行都不一样 返回一个0到1范围内的随机数</span><br><span class="line">select rand();</span><br><span class="line"></span><br><span class="line">--指定种子取随机数函数: rand(int seed) 得到一个稳定的随机数序列</span><br><span class="line">select rand(2);</span><br><span class="line"></span><br><span class="line">--二进制函数:  bin(BIGINT a)</span><br><span class="line">select bin(18);</span><br><span class="line"></span><br><span class="line">--进制转换函数: conv(BIGINT num, int from_base, int to_base)</span><br><span class="line">select conv(17,10,16);</span><br><span class="line"></span><br><span class="line">--绝对值函数: abs</span><br><span class="line">select abs(-3.9);</span><br></pre></td></tr></table></figure>

<h4 id="Collection-Functions-集合函数"><a href="#Collection-Functions-集合函数" class="headerlink" title="Collection Functions 集合函数"></a><strong>Collection Functions 集合函数</strong></h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">•集合元素size函数: size(Map&lt;K.V&gt;) size(Array&lt;T&gt;)</span><br><span class="line">•取map集合keys函数: map_keys(Map&lt;K.V&gt;)</span><br><span class="line">•取map集合values函数: map_values(Map&lt;K.V&gt;)</span><br><span class="line">•判断数组是否包含指定元素: array_contains(Array&lt;T&gt;, value)</span><br><span class="line">•数组排序函数:sort_array(Array&lt;T&gt;)</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">--集合元素size函数: size(Map&lt;K.V&gt;) size(Array&lt;T&gt;)</span><br><span class="line">select size(`array`(11,22,33));</span><br><span class="line">select size(`map`(&quot;id&quot;,10086,&quot;name&quot;,&quot;zhangsan&quot;,&quot;age&quot;,18));</span><br><span class="line"></span><br><span class="line">--取map集合keys函数: map_keys(Map&lt;K.V&gt;)</span><br><span class="line">select map_keys(`map`(&quot;id&quot;,10086,&quot;name&quot;,&quot;zhangsan&quot;,&quot;age&quot;,18));</span><br><span class="line"></span><br><span class="line">--取map集合values函数: map_values(Map&lt;K.V&gt;)</span><br><span class="line">select map_values(`map`(&quot;id&quot;,10086,&quot;name&quot;,&quot;zhangsan&quot;,&quot;age&quot;,18));</span><br><span class="line"></span><br><span class="line">--判断数组是否包含指定元素: array_contains(Array&lt;T&gt;, value)</span><br><span class="line">select array_contains(`array`(11,22,33),11);</span><br><span class="line">select array_contains(`array`(11,22,33),66);</span><br><span class="line"></span><br><span class="line">--数组排序函数:sort_array(Array&lt;T&gt;)</span><br><span class="line">select sort_array(`array`(12,2,32));</span><br></pre></td></tr></table></figure>

<h4 id="Conditional-Functions-条件函数"><a href="#Conditional-Functions-条件函数" class="headerlink" title="Conditional Functions 条件函数"></a><strong>Conditional Functions 条件函数</strong></h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">if条件判断: if(boolean testCondition, T valueTrue, T valueFalseOrNull)</span><br><span class="line">•空判断函数: isnull( a )</span><br><span class="line">•非空判断函数: isnotnull ( a )</span><br><span class="line">•空值转换函数: nvl(T value, T default_value)</span><br><span class="line">•非空查找函数: COALESCE(T v1, T v2, ...)</span><br><span class="line">•条件转换函数: CASE a WHEN b THEN c [WHEN d THEN e]* [ELSE f] END</span><br><span class="line">•nullif( a, b ): 如果a = b，则返回NULL；否则返回NULL。否则返回一个</span><br><span class="line">•assert_true: 如果&#x27;condition&#x27;不为真，则引发异常，否则返回null</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">--使用之前课程创建好的student表数据</span><br><span class="line">select * from student limit 3;</span><br><span class="line"></span><br><span class="line">--if条件判断: if(boolean testCondition, T valueTrue, T valueFalseOrNull)</span><br><span class="line">select if(1=2,100,200);</span><br><span class="line">select if(sex =&#x27;男&#x27;,&#x27;M&#x27;,&#x27;W&#x27;) from student limit 3;</span><br><span class="line"></span><br><span class="line">--空判断函数: isnull( a )</span><br><span class="line">select isnull(&quot;allen&quot;);</span><br><span class="line">select isnull(null);</span><br><span class="line"></span><br><span class="line">--非空判断函数: isnotnull ( a )</span><br><span class="line">select isnotnull(&quot;allen&quot;);</span><br><span class="line">select isnotnull(null);</span><br><span class="line"></span><br><span class="line">--空值转换函数: nvl(T value, T default_value)</span><br><span class="line">select nvl(&quot;allen&quot;,&quot;itcast&quot;);</span><br><span class="line">select nvl(null,&quot;itcast&quot;);</span><br><span class="line"></span><br><span class="line">--非空查找函数: COALESCE(T v1, T v2, ...)</span><br><span class="line">--返回参数中的第一个非空值；如果所有值都为NULL，那么返回NULL</span><br><span class="line">select COALESCE(null,11,22,33);</span><br><span class="line">select COALESCE(null,null,null,33);</span><br><span class="line">select COALESCE(null,null,null);</span><br><span class="line"></span><br><span class="line">--条件转换函数: CASE a WHEN b THEN c [WHEN d THEN e]* [ELSE f] END</span><br><span class="line">select case 100 when 50 then &#x27;tom&#x27; when 100 then &#x27;mary&#x27; else &#x27;tim&#x27; end;</span><br><span class="line">select case sex when &#x27;男&#x27; then &#x27;man&#x27; else &#x27;women&#x27; end from student limit 3;</span><br><span class="line"></span><br><span class="line">--nullif( a, b ):</span><br><span class="line">-- 果a = b，则返回NULL；否则返回NULL。否则返回一个</span><br><span class="line">select nullif(11,11);</span><br><span class="line">select nullif(11,12);</span><br><span class="line"></span><br><span class="line">--assert_true(condition)</span><br><span class="line">--如果&#x27;condition&#x27;不为真，则引发异常，否则返回null</span><br><span class="line">SELECT assert_true(11 &gt;= 0);</span><br><span class="line">SELECT assert_true(-1 &gt;= 0);</span><br></pre></td></tr></table></figure>

<h4 id="Type-Conversion-Functions-类型转换函数"><a href="#Type-Conversion-Functions-类型转换函数" class="headerlink" title="Type Conversion Functions 类型转换函数"></a><strong>Type Conversion Functions 类型转换函数</strong></h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">任意数据类型之间转换:cast</span><br><span class="line">--任意数据类型之间转换:cast</span><br><span class="line">select cast(12.14 as bigint);</span><br><span class="line">select cast(12.14 as string);</span><br></pre></td></tr></table></figure>

<h4 id="Data-Masking-Functions-数据脱敏函数"><a href="#Data-Masking-Functions-数据脱敏函数" class="headerlink" title="Data Masking Functions 数据脱敏函数"></a><strong>Data Masking Functions 数据脱敏函数</strong></h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mask</span><br><span class="line">•mask_first_n(string str[, int n]</span><br><span class="line">•mask_last_n(string str[, int n])</span><br><span class="line">•mask_show_first_n(string str[, int n])</span><br><span class="line">•mask_show_last_n(string str[, int n])</span><br><span class="line">•mask_hash(string|char|varchar str)</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">--mask</span><br><span class="line">--将查询回的数据，大写字母转换为X，小写字母转换为x，数字转换为n。</span><br><span class="line">select mask(&quot;abc123DEF&quot;);</span><br><span class="line">select mask(&quot;abc123DEF&quot;,&#x27;-&#x27;,&#x27;.&#x27;,&#x27;^&#x27;); --自定义替换的字母</span><br><span class="line"></span><br><span class="line">--mask_first_n(string str[, int n]</span><br><span class="line">--对前n个进行脱敏替换</span><br><span class="line">select mask_first_n(&quot;abc123DEF&quot;,4);</span><br><span class="line"></span><br><span class="line">--mask_last_n(string str[, int n])</span><br><span class="line">select mask_last_n(&quot;abc123DEF&quot;,4);</span><br><span class="line"></span><br><span class="line">--mask_show_first_n(string str[, int n])</span><br><span class="line">--除了前n个字符，其余进行掩码处理</span><br><span class="line">select mask_show_first_n(&quot;abc123DEF&quot;,4);</span><br><span class="line"></span><br><span class="line">--mask_show_last_n(string str[, int n])</span><br><span class="line">select mask_show_last_n(&quot;abc123DEF&quot;,4);</span><br><span class="line"></span><br><span class="line">--mask_hash(string|char|varchar str)</span><br><span class="line">--返回字符串的hash编码。</span><br><span class="line">select mask_hash(&quot;abc123DEF&quot;);</span><br></pre></td></tr></table></figure>

<h4 id="Misc-Functions-其他杂项函数"><a href="#Misc-Functions-其他杂项函数" class="headerlink" title="Misc. Functions 其他杂项函数"></a><strong>Misc. Functions 其他杂项函数</strong></h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">hive调用java方法: java_method(class, method[, arg1[, arg2..]])</span><br><span class="line">•反射函数: reflect(class, method[, arg1[, arg2..]])</span><br><span class="line">•取哈希值函数:hash</span><br><span class="line">•current_user()、logged_in_user()、current_database()、version()</span><br><span class="line">•SHA-1加密: sha1(string/binary)</span><br><span class="line">•SHA-2家族算法加密：sha2(string/binary, int)  (SHA-224, SHA-256, SHA-384, SHA-512)</span><br><span class="line">•crc32加密:</span><br><span class="line">•MD5加密: md5(string/binary)</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">--hive调用java方法: java_method(class, method[, arg1[, arg2..]])</span><br><span class="line">select java_method(&quot;java.lang.Math&quot;,&quot;max&quot;,11,22);</span><br><span class="line"></span><br><span class="line">--反射函数: reflect(class, method[, arg1[, arg2..]])</span><br><span class="line">select reflect(&quot;java.lang.Math&quot;,&quot;max&quot;,11,22);</span><br><span class="line"></span><br><span class="line">--取哈希值函数:hash</span><br><span class="line">select hash(&quot;allen&quot;);</span><br><span class="line"></span><br><span class="line">--current_user()、logged_in_user()、current_database()、version()</span><br><span class="line"></span><br><span class="line">--SHA-1加密: sha1(string/binary)</span><br><span class="line">select sha1(&quot;allen&quot;);</span><br><span class="line"></span><br><span class="line">--SHA-2家族算法加密：sha2(string/binary, int)  (SHA-224, SHA-256, SHA-384, SHA-512)</span><br><span class="line">select sha2(&quot;allen&quot;,224);</span><br><span class="line">select sha2(&quot;allen&quot;,512);</span><br><span class="line"></span><br><span class="line">--crc32加密:</span><br><span class="line">select crc32(&quot;allen&quot;);</span><br><span class="line"></span><br><span class="line">--MD5加密: md5(string/binary)</span><br><span class="line">select md5(&quot;allen&quot;);</span><br></pre></td></tr></table></figure>

<h3 id="用户自定义函数"><a href="#用户自定义函数" class="headerlink" title="用户自定义函数"></a>用户自定义函数</h3><p><strong>用户自定义函数简称UDF</strong>，源自于英文user-defined function。自定义函数总共有3类，是根据函数输入输出的行数来区分的，分别是：</p>
<p><strong>UDF</strong>（User-Defined-Function）普通函数，一进一出</p>
<p><strong>UDAF</strong>（User-Defined Aggregation Function）聚合函数，多进一出</p>
<p><strong>UDTF</strong>（User-Defined Table-Generating Functions）表生成函数，一进多出</p>
<p>UDF分类标准可以扩大到Hive的所有函数中：<strong>包括内置函数和自定义函数</strong>。因为不管是什么类型的行数，一定满足于输入输出的要求，那么从输入几行和输出几行上来划分没有任何毛病。千万不要被UD（User-Defined）这两个字母所迷惑，照成视野的狭隘。</p>
<h4 id="UDF-普通函数"><a href="#UDF-普通函数" class="headerlink" title="UDF 普通函数"></a><strong>UDF 普通函数</strong></h4><p>UDF函数通常把它叫做普通函数，最大的特点是一进一出，也就是输入一行输出一行。比如round这样的取整函数，接收一行数据，输出的还是一行数据。</p>
<h4 id="UDAF-聚合函数"><a href="#UDAF-聚合函数" class="headerlink" title="UDAF 聚合函数"></a><strong>UDAF 聚合函数</strong></h4><p>UDAF函数通常把它叫做聚合函数，A所代表的单词就是Aggregation聚合的意思。最大的特点是多进一出，也就是输入多行输出一行。比如count、sum这样的函数。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">•count:统计检索到的总行数。</span><br><span class="line">•sum:求和</span><br><span class="line">•avg:求平均</span><br><span class="line">•min:最小值</span><br><span class="line">•max:最大值</span><br><span class="line">•数据收集函数（去重）: collect_set(col)</span><br><span class="line">•数据收集函数（不去重）: collect_list(col)</span><br></pre></td></tr></table></figure>

<h4 id="UDTF-表生成函数"><a href="#UDTF-表生成函数" class="headerlink" title="UDTF 表生成函数"></a><strong>UDTF 表生成函数</strong></h4><p>UDTF函数通常把它叫做表生成函数，T所代表的单词是Table-Generating表生成的意思。最大的特点是一进多出，也就是输入一行输出多行。</p>
<p>之所以叫做表生成函数，原因在于这类型的函数作用返回的结果类似于表（多行数据嘛），同时，UDTF函数也是我们接触比较少的函数，陌生。比如explode函数。</p>
<h2 id="高阶函数"><a href="#高阶函数" class="headerlink" title="高阶函数"></a>高阶函数</h2><h3 id="UDTF-之explode函数"><a href="#UDTF-之explode函数" class="headerlink" title="UDTF****之explode函数"></a><strong>UDTF****之explode函数</strong></h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">于UDTF表生成函数，很多人难以理解什么叫做输入一行，输出多行。</span><br><span class="line">为什么叫做表生成？能够产生表吗？下面我们就来学习Hive当做内置的一个非常著名的UDTF函数，名字叫做explode函数，中文戏称之为“爆炸函数”，可以炸开数据。</span><br><span class="line">explode函数接收map或者array类型的数据作为参数，然后把参数中的每个元素炸开变成一行数据。一个元素一行。这样的效果正好满足于输入一行输出多行。</span><br><span class="line">explode函数在关系型数据库中本身是不该出现的。</span><br><span class="line">因为他的出现本身就是在操作不满足第一范式的数据（每个属性都不可再分）。本身已经违背了数据库的设计原理，但是在面向分析的数据库或者数据仓库中，这些规范可以发生改变。</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">select explode(`array`(11,22,33)) as item;</span><br><span class="line"></span><br><span class="line">select explode(`map`(&quot;id&quot;,10086,&quot;name&quot;,&quot;zhangsan&quot;,&quot;age&quot;,18));</span><br></pre></td></tr></table></figure>

<h3 id="Lateral-View侧视图"><a href="#Lateral-View侧视图" class="headerlink" title="Lateral View侧视图"></a><strong>Lateral</strong> <strong>View侧视图</strong></h3><p><strong>Lateral View</strong>是一种特殊的语法，主要用于<strong>搭配UDTF类型功能的函数一起使用</strong>，用于解决UDTF函数的一些查询限制的问题。</p>
<p>侧视图的原理是将UDTF的结果构建成一个类似于视图的表，然后将原表中的每一行和UDTF函数输出的每一行进行连接，生成一张新的虚拟表。这样就避免了UDTF的使用限制问题。使用lateral view时也可以对UDTF产生的记录设置字段名称，产生的字段可以用于group by、order by 、limit等语句中，不需要再单独嵌套一层子查询。</p>
<p>一般只要使用UDTF，就会固定搭配lateral view使用。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">--lateral view侧视图基本语法如下</span><br><span class="line">select …… from tabelA lateral view UDTF(xxx) 别名 as col1,col2,col3……;</span><br><span class="line"></span><br><span class="line">select a.team_name ,b.year</span><br><span class="line">from the_nba_championship a lateral view explode(champion_year) b as year</span><br><span class="line"></span><br><span class="line">--根据年份倒序排序</span><br><span class="line">select a.team_name ,b.year</span><br><span class="line">from the_nba_championship a lateral view explode(champion_year) b as year</span><br><span class="line">order by b.year desc;</span><br></pre></td></tr></table></figure>

<h3 id="Aggregation-聚合函数"><a href="#Aggregation-聚合函数" class="headerlink" title="Aggregation 聚合函数"></a><strong>Aggregation</strong> <strong>聚合函数</strong></h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line">--------------基础聚合函数-------------------</span><br><span class="line">--1、测试数据准备</span><br><span class="line">drop table if exists student;</span><br><span class="line">create table student(</span><br><span class="line">    num int,</span><br><span class="line">    name string,</span><br><span class="line">    sex string,</span><br><span class="line">    age int,</span><br><span class="line">    dept string)</span><br><span class="line">row format delimited</span><br><span class="line">fields terminated by &#x27;,&#x27;;</span><br><span class="line">--加载数据</span><br><span class="line">load data local inpath &#x27;/root/hivedata/students.txt&#x27; into table student;</span><br><span class="line">--验证</span><br><span class="line">select * from student;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">--场景1：没有group by子句的聚合操作</span><br><span class="line">select count(*) as cnt1,count(1) as cnt2 from student; --两个一样</span><br><span class="line"></span><br><span class="line">--场景2：带有group by子句的聚合操作 注意group by语法限制</span><br><span class="line">select sex,count(*) as cnt from student group by sex;</span><br><span class="line"></span><br><span class="line">--场景3：select时多个聚合函数一起使用</span><br><span class="line">select count(*) as cnt1,avg(age) as cnt2 from student;</span><br><span class="line"></span><br><span class="line">--场景4：聚合函数和case when条件转换函数、coalesce函数、if函数使用</span><br><span class="line">select</span><br><span class="line">    sum(CASE WHEN sex = &#x27;男&#x27;THEN 1 ELSE 0 END)</span><br><span class="line">from student;</span><br><span class="line"></span><br><span class="line">select</span><br><span class="line">    sum(if(sex = &#x27;男&#x27;,1,0))</span><br><span class="line">from student;</span><br><span class="line"></span><br><span class="line">--场景5：聚合参数不支持嵌套聚合函数</span><br><span class="line">select avg(count(*))  from student;</span><br><span class="line"></span><br><span class="line">--聚合参数针对null的处理方式</span><br><span class="line">--null null 0</span><br><span class="line">select max(null), min(null), count(null);</span><br><span class="line">--下面这两个不支持null</span><br><span class="line">select sum(null), avg(null);</span><br><span class="line"></span><br><span class="line">--场景5：聚合操作时针对null的处理</span><br><span class="line">CREATE TABLE tmp_1 (val1 int, val2 int);</span><br><span class="line">INSERT INTO TABLE tmp_1 VALUES (1, 2),(null,2),(2,3);</span><br><span class="line">select * from tmp_1;</span><br><span class="line">--第二行数据(NULL, 2) 在进行sum(val1 + val2)的时候会被忽略</span><br><span class="line">select sum(val1), sum(val1 + val2) from tmp_1;</span><br><span class="line">--可以使用coalesce函数解决</span><br><span class="line">select</span><br><span class="line">    sum(coalesce(val1,0)),</span><br><span class="line">    sum(coalesce(val1,0) + val2)</span><br><span class="line">from tmp_1;</span><br><span class="line"></span><br><span class="line">--场景6：配合distinct关键字去重聚合</span><br><span class="line">--此场景下，会编译期间会自动设置只启动一个reduce task处理数据  性能可能会不会 造成数据拥堵</span><br><span class="line">select count(distinct sex) as cnt1 from student;</span><br><span class="line">--可以先去重 在聚合 通过子查询完成</span><br><span class="line">--因为先执行distinct的时候 可以使用多个reducetask来跑数据</span><br><span class="line">select count(*) as gender_uni_cnt</span><br><span class="line">from (select distinct sex from student) a;</span><br><span class="line"></span><br><span class="line">--案例需求：找出student中男女学生年龄最大的及其名字</span><br><span class="line">--这里使用了struct来构造数据 然后针对struct应用max找出最大元素 然后取值</span><br><span class="line">select sex,</span><br><span class="line">max(struct(age, name)).col1 as age,</span><br><span class="line">max(struct(age, name)).col2 as name</span><br><span class="line">from student</span><br><span class="line">group by sex;</span><br><span class="line"></span><br><span class="line">select struct(age, name) from student;</span><br><span class="line">select struct(age, name).col1 from student;</span><br><span class="line">select max(struct(age, name)) from student;</span><br></pre></td></tr></table></figure>

<h3 id="Grouping-sets"><a href="#Grouping-sets" class="headerlink" title="Grouping sets"></a><strong>Grouping</strong> <strong>sets</strong></h3><p><strong>grouping sets</strong>是一种将多个group by逻辑写在一个sql语句中的便利写法。</p>
<p>等价于将不同维度的GROUP BY结果集进行UNION ALL。</p>
<p>GROUPING__ID表示结果属于哪一个分组集合。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">---group sets---------</span><br><span class="line">SELECT</span><br><span class="line">    month,</span><br><span class="line">    day,</span><br><span class="line">    COUNT(DISTINCT cookieid) AS nums,</span><br><span class="line">    GROUPING__ID</span><br><span class="line">FROM cookie_info</span><br><span class="line">GROUP BY month,day</span><br><span class="line">GROUPING SETS (month,day)</span><br><span class="line">ORDER BY GROUPING__ID;</span><br><span class="line"></span><br><span class="line">--grouping_id表示这一组结果属于哪个分组集合，</span><br><span class="line">--根据grouping sets中的分组条件month，day，1是代表month，2是代表day</span><br><span class="line"></span><br><span class="line">--等价于</span><br><span class="line">SELECT month,NULL,COUNT(DISTINCT cookieid) AS nums,1 AS GROUPING__ID FROM cookie_info GROUP BY month</span><br><span class="line">UNION ALL</span><br><span class="line">SELECT NULL as month,day,COUNT(DISTINCT cookieid) AS nums,2 AS GROUPING__ID FROM cookie_info GROUP BY day;</span><br><span class="line">--再比如</span><br><span class="line">SELECT</span><br><span class="line">    month,</span><br><span class="line">    day,</span><br><span class="line">    COUNT(DISTINCT cookieid) AS nums,</span><br><span class="line">    GROUPING__ID</span><br><span class="line">FROM cookie_info</span><br><span class="line">GROUP BY month,day</span><br><span class="line">GROUPING SETS (month,day,(month,day))</span><br><span class="line">ORDER BY GROUPING__ID;</span><br><span class="line"></span><br><span class="line">--等价于</span><br><span class="line">SELECT month,NULL,COUNT(DISTINCT cookieid) AS nums,1 AS GROUPING__ID FROM cookie_info GROUP BY month</span><br><span class="line">UNION ALL</span><br><span class="line">SELECT NULL,day,COUNT(DISTINCT cookieid) AS nums,2 AS GROUPING__ID FROM cookie_info GROUP BY day</span><br><span class="line">UNION ALL</span><br><span class="line">SELECT month,day,COUNT(DISTINCT cookieid) AS nums,3 AS GROUPING__ID FROM cookie_info GROUP BY month,day;</span><br></pre></td></tr></table></figure>

<h2 id="Window-functions-窗口函数"><a href="#Window-functions-窗口函数" class="headerlink" title="Window functions 窗口函数"></a><strong>Window functions</strong> <strong>窗口函数</strong></h2><p>窗口函数（Window functions）是一种SQL函数，非常适合于数据分析，因此也叫做OLAP函数，其最大特点是：输入值是从SELECT语句的结果集中的一行或多行的“窗口”中获取的。你也可以理解为窗口有大有小（行有多有少）。</p>
<p>通过OVER子句，窗口函数与其他SQL函数有所区别。如果函数具有OVER子句，则它是窗口函数。如果它缺少OVER子句，则它是一个普通的聚合函数。</p>
<p>窗口函数可以简单地解释为类似于聚合函数的计算函数，但是通过GROUP BY子句组合的常规聚合会隐藏正在聚合的各个行，最终输出一行，<strong>窗口函数聚合后还可以访问当中的各个行，并且可以将这些行中的某些属性添加到结果集中</strong>。</p>
<p><img src="http://img.wqkenqing.ren/typora_img/CleanShot%202023-10-31%20at%2017.56.26@2x.png" alt="CleanShot 2023-10-31 at 17.56.26@2x" loading="lazy" onerror='this.onerror=null;this.src="/daydoc/img/404.jpg"'></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">Function(arg1,..., argn) OVER ([PARTITION BY &lt;...&gt;] [ORDER BY &lt;....&gt;] [&lt;window_expression&gt;])</span><br><span class="line"></span><br><span class="line">--其中Function(arg1,..., argn) 可以是下面分类中的任意一个</span><br><span class="line">    --聚合函数：比如sum max avg等</span><br><span class="line">    --排序函数：比如rank row_number等</span><br><span class="line">    --分析函数：比如lead lag first_value等</span><br><span class="line"></span><br><span class="line">--OVER [PARTITION BY &lt;...&gt;] 类似于group by 用于指定分组  每个分组你可以把它叫做窗口</span><br><span class="line">--如果没有PARTITION BY 那么整张表的所有行就是一组</span><br><span class="line"></span><br><span class="line">--[ORDER BY &lt;....&gt;]  用于指定每个分组内的数据排序规则 支持ASC、DESC</span><br><span class="line"></span><br><span class="line">--[&lt;window_expression&gt;] 用于指定每个窗口中 操作的数据范围 默认是窗口中所有行</span><br></pre></td></tr></table></figure>

<h4 id="窗口聚合函数"><a href="#窗口聚合函数" class="headerlink" title="窗口聚合函数"></a><strong>窗口聚合函数</strong></h4><p>从Hive v2.2.0开始，支持DISTINCT与窗口函数中的聚合函数一起使用。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">-----窗口聚合函数的使用-----------</span><br><span class="line">--1、求出每个用户总pv数  sum+group by普通常规聚合操作</span><br><span class="line">select cookieid,sum(pv) as total_pv from website_pv_info group by cookieid;</span><br><span class="line"></span><br><span class="line">--2、sum+窗口函数 总共有四种用法 注意是整体聚合 还是累积聚合</span><br><span class="line">--sum(...) over( )对表所有行求和</span><br><span class="line">--sum(...) over( order by ... ) 连续累积求和</span><br><span class="line">--sum(...) over( partition by... ) 同组内所有行求和</span><br><span class="line">--sum(...) over( partition by... order by ... ) 在每个分组内，连续累积求和</span><br><span class="line"></span><br><span class="line">--需求：求出网站总的pv数 所有用户所有访问加起来</span><br><span class="line">--sum(...) over( )对表所有行求和</span><br><span class="line">select cookieid,createtime,pv,</span><br><span class="line">       sum(pv) over() as total_pv</span><br><span class="line">from website_pv_info;</span><br><span class="line"></span><br><span class="line">--需求：求出每个用户总pv数</span><br><span class="line">--sum(...) over( partition by... )，同组内所行求和</span><br><span class="line">select cookieid,createtime,pv,</span><br><span class="line">       sum(pv) over(partition by cookieid) as total_pv</span><br><span class="line">from website_pv_info;</span><br><span class="line"></span><br><span class="line">--需求：求出每个用户截止到当天，累积的总pv数</span><br><span class="line">--sum(...) over( partition by... order by ... )，在每个分组内，连续累积求和</span><br><span class="line">select cookieid,createtime,pv,</span><br><span class="line">       sum(pv) over(partition by cookieid order by createtime) as current_total_pv</span><br><span class="line">from website_pv_info;</span><br></pre></td></tr></table></figure>

<h4 id="窗口表达式"><a href="#窗口表达式" class="headerlink" title="窗口表达式"></a><strong>窗口表达式</strong></h4><p>我们知道，在<strong>sum(…) over( partition by… order by … )语法完整</strong>的情况下，进行的累积聚合操作，默认累积聚合行为是：<strong>从第一行聚合到当前行</strong>。</p>
<p>Window expression窗口表达式给我们提供了一种控制行范围的能力，比如向前2行，向后3行。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">关键字是rows between，包括下面这几个选项</span><br><span class="line">- preceding：往前</span><br><span class="line">- following：往后</span><br><span class="line">- current row：当前行</span><br><span class="line">- unbounded：边界</span><br><span class="line">- unbounded preceding 表示从前面的起点</span><br><span class="line">- unbounded following：表示到后面的终点</span><br></pre></td></tr></table></figure>



<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">---窗口表达式</span><br><span class="line">--第一行到当前行</span><br><span class="line">select cookieid,createtime,pv,</span><br><span class="line">       sum(pv) over(partition by cookieid order by createtime rows between unbounded preceding and current row) as pv2</span><br><span class="line">from website_pv_info;</span><br><span class="line"></span><br><span class="line">--向前3行至当前行</span><br><span class="line">select cookieid,createtime,pv,</span><br><span class="line">       sum(pv) over(partition by cookieid order by createtime rows between 3 preceding and current row) as pv4</span><br><span class="line">from website_pv_info;</span><br><span class="line"></span><br><span class="line">--向前3行 向后1行</span><br><span class="line">select cookieid,createtime,pv,</span><br><span class="line">       sum(pv) over(partition by cookieid order by createtime rows between 3 preceding and 1 following) as pv5</span><br><span class="line">from website_pv_info;</span><br><span class="line"></span><br><span class="line">--当前行至最后一行</span><br><span class="line">select cookieid,createtime,pv,</span><br><span class="line">       sum(pv) over(partition by cookieid order by createtime rows between current row and unbounded following) as pv6</span><br><span class="line">from website_pv_info;</span><br><span class="line"></span><br><span class="line">--第一行到最后一行 也就是分组内的所有行</span><br><span class="line">select cookieid,createtime,pv,</span><br><span class="line">       sum(pv) over(partition by cookieid order by createtime rows between unbounded preceding  and unbounded following) as pv6</span><br><span class="line">from website_pv_info;</span><br></pre></td></tr></table></figure>

<h4 id="窗口分析函数"><a href="#窗口分析函数" class="headerlink" title="窗口分析函数"></a>窗口分析函数</h4><p>LAG(col,n,DEFAULT) 用于统计窗口内往上第n行值</p>
<p>第一个参数为列名，第二个参数为往上第n行（可选，默认为1），第三个参数为默认值（当往上第n行为NULL时候，取默认值，如不指定，则为NULL）；</p>
<p>LEAD(col,n,DEFAULT) 用于统计窗口内往下第n行值</p>
<p>第一个参数为列名，第二个参数为往下第n行（可选，默认为1），第三个参数为默认值（当往下第n行为NULL时候，取默认值，如不指定，则为NULL）；</p>
<p>FIRST_VALUE 取分组内排序后，截止到当前行，第一个值；</p>
<p>LAST_VALUE 取分组内排序后，截止到当前行，最后一个值；</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">-----------窗口分析函数----------</span><br><span class="line">--LAG</span><br><span class="line">SELECT cookieid,</span><br><span class="line">       createtime,</span><br><span class="line">       url,</span><br><span class="line">       ROW_NUMBER() OVER(PARTITION BY cookieid ORDER BY createtime) AS rn,</span><br><span class="line">       LAG(createtime,1,&#x27;1970-01-01 00:00:00&#x27;) OVER(PARTITION BY cookieid ORDER BY createtime) AS last_1_time,</span><br><span class="line">       LAG(createtime,2) OVER(PARTITION BY cookieid ORDER BY createtime) AS last_2_time</span><br><span class="line">FROM website_url_info;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">--LEAD</span><br><span class="line">SELECT cookieid,</span><br><span class="line">       createtime,</span><br><span class="line">       url,</span><br><span class="line">       ROW_NUMBER() OVER(PARTITION BY cookieid ORDER BY createtime) AS rn,</span><br><span class="line">       LEAD(createtime,1,&#x27;1970-01-01 00:00:00&#x27;) OVER(PARTITION BY cookieid ORDER BY createtime) AS next_1_time,</span><br><span class="line">       LEAD(createtime,2) OVER(PARTITION BY cookieid ORDER BY createtime) AS next_2_time</span><br><span class="line">FROM website_url_info;</span><br><span class="line"></span><br><span class="line">--FIRST_VALUE</span><br><span class="line">SELECT cookieid,</span><br><span class="line">       createtime,</span><br><span class="line">       url,</span><br><span class="line">       ROW_NUMBER() OVER(PARTITION BY cookieid ORDER BY createtime) AS rn,</span><br><span class="line">       FIRST_VALUE(url) OVER(PARTITION BY cookieid ORDER BY createtime) AS first1</span><br><span class="line">FROM website_url_info;</span><br><span class="line"></span><br><span class="line">--LAST_VALUE</span><br><span class="line">SELECT cookieid,</span><br><span class="line">       createtime,</span><br><span class="line">       url,</span><br><span class="line">       ROW_NUMBER() OVER(PARTITION BY cookieid ORDER BY createtime) AS rn,</span><br><span class="line">       LAST_VALUE(url) OVER(PARTITION BY cookieid ORDER BY createtime) AS last1</span><br><span class="line">FROM website_url_info;</span><br></pre></td></tr></table></figure>


</article>
    
    

</div>
<div class="trm-post-next-prev row">
    <div class="col-lg-12">
        <!-- title -->
        <h5 class="trm-title-with-divider">
            其他文章
            <span data-number="02"></span>
        </h5>
    </div>
    
        <div class="col-lg-6">
    <div class="trm-blog-card trm-scroll-animation">
        <a href="/daydoc/2023/10/31/%E7%8E%8B%E9%98%81/%E5%B7%A5%E4%BD%9C/%E9%A1%B9%E7%9B%AE/%E6%B4%AA%E9%9B%85/%E5%A4%A7%E6%95%B0%E6%8D%AE%E9%AA%8C%E8%AF%81/" class="trm-cover-frame trm-anima-link">
            
            
                <div class="trm-cover-img" data-random-img></div>
            
        </a>
        
        <div class="trm-card-descr">
            <div class="trm-label trm-category trm-mb-20">
                <a href=" /daydoc/categories/%E9%A1%B9%E7%9B%AE/">
                    项目
                </a>
            </div>
            <h5>
                <a href="/daydoc/2023/10/31/%E7%8E%8B%E9%98%81/%E5%B7%A5%E4%BD%9C/%E9%A1%B9%E7%9B%AE/%E6%B4%AA%E9%9B%85/%E5%A4%A7%E6%95%B0%E6%8D%AE%E9%AA%8C%E8%AF%81/" class="trm-anima-link">
                    大数据验证
                </a>
            </h5>
            <div class="trm-divider trm-mb-20 trm-mt-20"></div>
            <ul class="trm-card-data trm-label">
                <li>23/10/31</li>
                <li>15:51</li>
                
                
            </ul>
        </div>
    </div>
</div>
    
    
        <div class="col-lg-6">
    <div class="trm-blog-card trm-scroll-animation">
        <a href="/daydoc/2023/10/27/%E7%8E%8B%E9%98%81/%E5%9B%9E%E9%A1%BE/hive/hive%E6%A2%B3%E7%90%86/" class="trm-cover-frame trm-anima-link">
            
            
                <div class="trm-cover-img" data-random-img></div>
            
        </a>
        
        <div class="trm-card-descr">
            <div class="trm-label trm-category trm-mb-20">
                <a href=" /daydoc/categories/%E5%9B%9E%E9%A1%BE/">
                    回顾
                </a>
            </div>
            <h5>
                <a href="/daydoc/2023/10/27/%E7%8E%8B%E9%98%81/%E5%9B%9E%E9%A1%BE/hive/hive%E6%A2%B3%E7%90%86/" class="trm-anima-link">
                    hive梳理
                </a>
            </h5>
            <div class="trm-divider trm-mb-20 trm-mt-20"></div>
            <ul class="trm-card-data trm-label">
                <li>23/10/27</li>
                <li>14:55</li>
                
                
            </ul>
        </div>
    </div>
</div>
    
</div>

    



                    <div class="trm-divider footer-divider"></div>

                    <!-- footer -->
                    <footer class="trm-scroll-animation">

    

    

    
        <div class="trm-footer-item">
            <span>
                由 <a href="https://hexo.io" target="_blank" rel="noopener">Hexo</a> 驱动 v6.3.0
            </span>
            <span class="footer-separator" data-separator=" | "></span>
            <span> 
                主题 - 
                <a rel="noopener" href='https://github.com/MaLuns/hexo-theme-async' target='_blank'>Async</a>
                v2.1.6
            </span>
        </div>
      

     

     
</footer>
 
                    <!-- footer end -->

                </div>
            </div>
        </div>
    </div>
</div>
            <!-- body end -->

            

    <div id="post-toc" class="trm-post-toc">
      <div class="trm-post-toc-header">
        目录导航
				<span id="post-toc-top">
					置顶
				</span>
      </div>
      <div class="trm-post-toc-content">
        <ol class="trm-toc"><li class="trm-toc-item trm-toc-level-2" title="内置运算符"><a rel="nofollow" class="trm-toc-link" href="#内置运算符"><span class="trm-toc-number">1.</span> <span class="trm-toc-text">内置运算符</span></a><ol class="trm-toc-child"><li class="trm-toc-item trm-toc-level-3" title="关系运算符"><a rel="nofollow" class="trm-toc-link" href="#关系运算符"><span class="trm-toc-number">1.1.</span> <span class="trm-toc-text">关系运算符</span></a></li><li class="trm-toc-item trm-toc-level-3" title="算术运算符"><a rel="nofollow" class="trm-toc-link" href="#算术运算符"><span class="trm-toc-number">1.2.</span> <span class="trm-toc-text">算术运算符</span></a></li><li class="trm-toc-item trm-toc-level-3" title="逻辑运算符"><a rel="nofollow" class="trm-toc-link" href="#逻辑运算符"><span class="trm-toc-number">1.3.</span> <span class="trm-toc-text">逻辑运算符</span></a></li></ol></li><li class="trm-toc-item trm-toc-level-2" title="Hive函数"><a rel="nofollow" class="trm-toc-link" href="#Hive函数"><span class="trm-toc-number">2.</span> <span class="trm-toc-text">Hive函数</span></a><ol class="trm-toc-child"><li class="trm-toc-item trm-toc-level-3" title="内置函数"><a rel="nofollow" class="trm-toc-link" href="#内置函数"><span class="trm-toc-number">2.1.</span> <span class="trm-toc-text">内置函数</span></a><ol class="trm-toc-child"><li class="trm-toc-item trm-toc-level-4" title="String Functions 字符串函数"><a rel="nofollow" class="trm-toc-link" href="#String-Functions-字符串函数"><span class="trm-toc-number">2.1.1.</span> <span class="trm-toc-text">String Functions 字符串函数</span></a></li><li class="trm-toc-item trm-toc-level-4" title="Date Functions 日期函数"><a rel="nofollow" class="trm-toc-link" href="#Date-Functions-日期函数"><span class="trm-toc-number">2.1.2.</span> <span class="trm-toc-text">Date Functions 日期函数</span></a></li><li class="trm-toc-item trm-toc-level-4" title="Mathematical Functions 数学函数"><a rel="nofollow" class="trm-toc-link" href="#Mathematical-Functions-数学函数"><span class="trm-toc-number">2.1.3.</span> <span class="trm-toc-text">Mathematical Functions 数学函数</span></a></li><li class="trm-toc-item trm-toc-level-4" title="Collection Functions 集合函数"><a rel="nofollow" class="trm-toc-link" href="#Collection-Functions-集合函数"><span class="trm-toc-number">2.1.4.</span> <span class="trm-toc-text">Collection Functions 集合函数</span></a></li><li class="trm-toc-item trm-toc-level-4" title="Conditional Functions 条件函数"><a rel="nofollow" class="trm-toc-link" href="#Conditional-Functions-条件函数"><span class="trm-toc-number">2.1.5.</span> <span class="trm-toc-text">Conditional Functions 条件函数</span></a></li><li class="trm-toc-item trm-toc-level-4" title="Type Conversion Functions 类型转换函数"><a rel="nofollow" class="trm-toc-link" href="#Type-Conversion-Functions-类型转换函数"><span class="trm-toc-number">2.1.6.</span> <span class="trm-toc-text">Type Conversion Functions 类型转换函数</span></a></li><li class="trm-toc-item trm-toc-level-4" title="Data Masking Functions 数据脱敏函数"><a rel="nofollow" class="trm-toc-link" href="#Data-Masking-Functions-数据脱敏函数"><span class="trm-toc-number">2.1.7.</span> <span class="trm-toc-text">Data Masking Functions 数据脱敏函数</span></a></li><li class="trm-toc-item trm-toc-level-4" title="Misc. Functions 其他杂项函数"><a rel="nofollow" class="trm-toc-link" href="#Misc-Functions-其他杂项函数"><span class="trm-toc-number">2.1.8.</span> <span class="trm-toc-text">Misc. Functions 其他杂项函数</span></a></li></ol></li><li class="trm-toc-item trm-toc-level-3" title="用户自定义函数"><a rel="nofollow" class="trm-toc-link" href="#用户自定义函数"><span class="trm-toc-number">2.2.</span> <span class="trm-toc-text">用户自定义函数</span></a><ol class="trm-toc-child"><li class="trm-toc-item trm-toc-level-4" title="UDF 普通函数"><a rel="nofollow" class="trm-toc-link" href="#UDF-普通函数"><span class="trm-toc-number">2.2.1.</span> <span class="trm-toc-text">UDF 普通函数</span></a></li><li class="trm-toc-item trm-toc-level-4" title="UDAF 聚合函数"><a rel="nofollow" class="trm-toc-link" href="#UDAF-聚合函数"><span class="trm-toc-number">2.2.2.</span> <span class="trm-toc-text">UDAF 聚合函数</span></a></li><li class="trm-toc-item trm-toc-level-4" title="UDTF 表生成函数"><a rel="nofollow" class="trm-toc-link" href="#UDTF-表生成函数"><span class="trm-toc-number">2.2.3.</span> <span class="trm-toc-text">UDTF 表生成函数</span></a></li></ol></li></ol></li><li class="trm-toc-item trm-toc-level-2" title="高阶函数"><a rel="nofollow" class="trm-toc-link" href="#高阶函数"><span class="trm-toc-number">3.</span> <span class="trm-toc-text">高阶函数</span></a><ol class="trm-toc-child"><li class="trm-toc-item trm-toc-level-3" title="UDTF****之explode函数"><a rel="nofollow" class="trm-toc-link" href="#UDTF-之explode函数"><span class="trm-toc-number">3.1.</span> <span class="trm-toc-text">UDTF****之explode函数</span></a></li><li class="trm-toc-item trm-toc-level-3" title="Lateral View侧视图"><a rel="nofollow" class="trm-toc-link" href="#Lateral-View侧视图"><span class="trm-toc-number">3.2.</span> <span class="trm-toc-text">Lateral View侧视图</span></a></li><li class="trm-toc-item trm-toc-level-3" title="Aggregation 聚合函数"><a rel="nofollow" class="trm-toc-link" href="#Aggregation-聚合函数"><span class="trm-toc-number">3.3.</span> <span class="trm-toc-text">Aggregation 聚合函数</span></a></li><li class="trm-toc-item trm-toc-level-3" title="Grouping sets"><a rel="nofollow" class="trm-toc-link" href="#Grouping-sets"><span class="trm-toc-number">3.4.</span> <span class="trm-toc-text">Grouping sets</span></a></li></ol></li><li class="trm-toc-item trm-toc-level-2" title="Window functions 窗口函数"><a rel="nofollow" class="trm-toc-link" href="#Window-functions-窗口函数"><span class="trm-toc-number">4.</span> <span class="trm-toc-text">Window functions 窗口函数</span></a><ol class="trm-toc-child"><li class="trm-toc-item trm-toc-level-4" title="窗口聚合函数"><a rel="nofollow" class="trm-toc-link" href="#窗口聚合函数"><span class="trm-toc-number">4.0.1.</span> <span class="trm-toc-text">窗口聚合函数</span></a></li><li class="trm-toc-item trm-toc-level-4" title="窗口表达式"><a rel="nofollow" class="trm-toc-link" href="#窗口表达式"><span class="trm-toc-number">4.0.2.</span> <span class="trm-toc-text">窗口表达式</span></a></li><li class="trm-toc-item trm-toc-level-4" title="窗口分析函数"><a rel="nofollow" class="trm-toc-link" href="#窗口分析函数"><span class="trm-toc-number">4.0.3.</span> <span class="trm-toc-text">窗口分析函数</span></a></li></ol></li></ol></li></ol>
      </div>
    </div>

            
<div class="trm-fixed-container">
    
        <div class="trm-fixed-btn post-toc-btn" data-title="目录">
            <i class="iconfont fas fa-th-list"></i>
        </div>
    
    
        <div class="trm-fixed-btn" data-title="阅读模式" onclick="asyncFun.switchReadMode()">
            <i class="iconfont fas fa-book-reader"></i>
        </div>
    
    
    <div id="trm-back-top" class="trm-fixed-btn" data-title="回到顶部">
        <i class="iconfont fas fa-arrow-up"></i>
    </div>
</div>
        </div>
      </div>
      <!-- scroll container end -->
  </div>
  <!-- app wrapper end -->

  
  <!-- Plugin -->




    
    
<script src="https://unpkg.com/@fancyapps/ui@4.0/dist/fancybox.umd.js"></script>

    

    
        <script src="/daydoc/js/plugins/typing.js?v=2.1.6"></script>
    

    

    <!-- 数学公式 -->
    

    <!-- 评论插件 -->
    
        

        
    



<!-- CDN -->


    

    

    




    <!-- Service Worker -->
    
    <!-- baidu push -->
    


<script id="async-script" src="/daydoc/js/main.js?v=2.1.6"></script>

</body>

</html>
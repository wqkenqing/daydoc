title: 组件-hive篇 
date: 2023-10-24 21:27:00 
tags: []
categories: [备战]
password: 7FKBKZrTTTPG2LnC

---
 <!--more-->

## Hive Sql


fifa 数据集

男性球员数据集

* 导入了初始数据，出现了较多为NULL的行。
  * 我的处理方式是通过create table tablenams as select * from tbale  tablename where is player_id is not NULL 的方式进行了数据的导入

* 导入后的数据出现了age 列数据不太统一的情况，需要进行治理
  * 我的思路是先group 一下看看
  * 也就是这里有一个需求，查看age的分布情况

* 排查出来了原因了，是因为有"CB, LB"这种数据的存在的原因。

  * 如下，可以过通SERDEPROPERTIES，来指定包围符号

  ```
  ROW FORMAT SERDE 'org.apache.hadoop.hive.serde2.OpenCSVSerde'
  WITH SERDEPROPERTIES(
      'separatorChar' = ',',
      'quoteChar' = '"', 
       'escapeChar' = '\\'
  )
           stored as TEXTFILE
  ```

* 之前有一个乱码的问题,用下面等方式解决的。

```
use hive; 
alter table COLUMNS_V2 modify column COMMENT varchar(256) character set utf8;
alter table TABLE_PARAMS modify column PARAM_VALUE varchar(4000) character set utf8;
alter table PARTITION_PARAMS  modify column PARAM_VALUE varchar(4000) character set utf8;
alter table PARTITION_KEYS  modify column PKEY_COMMENT varchar(4000) character set utf8;
alter table  INDEX_PARAMS  modify column PARAM_VALUE  varchar(4000) character set utf8;
```

* 这里想要查询最大的年龄，出现了查不出来的情况，分析可能是age有为NULL的情况。所以这里

  ```
  select max(age) from male_players_info_1 where age is not null
  ```

  * 验证了一下，目前不是这个问题，目前猜测可能是yarn中的容器生成不成功
  * 经过调试后发现，上述情况都不是，而是导入的数据中有一行是表头，所以也就是说结果出现age的原因是age转成int的时候值最大。这个确实没毛病。
  * 处理方式，就是重新导入了一遍数据
    * 因为hive不支持delete语句。
  * 经此上面的sql可以执行了

* 尝试通过dbp数据集成导数据到mysql。尝试了一下没成功，查看日志

  ```
  目前看可能是嵩哥那边接受服务有问题，所以这里要换一种方案
  ```

* 我直接通过sqoop将表导入到mysql中去。

  ```
  sqoop export --mapreduce-job-name synchro_task-174 --hcatalog-table male_player_info_1 --hcatalog-database sample --table male_player_info --connect jdbc:mysql://192.168.10.238:3306/dbp_main?useUnicode=true&characterEncoding=UTF8&serverTimezone=GMT%2B8 --username root --password yg123456
  ```

  

```
sqoop export --connect jdbc:mysql://mysql-host:3306/database-name --username your-username --password your-password --table mysql-table --export-dir /user/hive/warehouse/hive-table --input-fields-terminated-by ','

```

```
sqoop export --mapreduce-job-name synchro_task-174 --hcatalog-table male_player_info_1 --hcatalog-database sample --table male_player_info --connect "jdbc:mysql://192.168.10.238:3306/dbp_main?useUnicode=true&characterEncoding=UTF8&serverTimezone=GMT%2B8" --username root --password yg123456 --driver com.mysql.cj.jdbc.Driver

```

```
sqoop export --connect "jdbc:mysql://192.168.10.238:3306/dbp_main?useUnicode=true&characterEncoding=UTF8&serverTimezone=GMT%2B8" --username root --password yg123456 --table male_player_info --hcatalog-table male_player_info_1 --hcatalog-database sample --mapreduce-job-name synchro_task-174 --driver com.mysql.cj.jdbc.Driver

```


![CleanShot 2024-06-18 at 11.11.24@2x](http://img.wqkenqing.ren/typora_img/CleanShot%202024-06-18%20at%2011.11.24@2x.png)

![CleanShot 2024-06-18 at 11.11.32@2x](http://img.wqkenqing.ren/typora_img/CleanShot%202024-06-18%20at%2011.11.32@2x.png)

sunrise_vehicleInOut，sunrise_trafficJunction 这两个topic留存条数降低一下，具体可以根据你们的服务负载来配置。

```
SELECT dp.name, MAX(dv.total_sale_num) AS max_total_sale_num
FROM douyin_top_products dp
JOIN douyin_top_video dv ON dp.video_basic_id = dv.video_basic_id
JOIN (
    SELECT dp.video_basic_id, MAX(dv.total_sale_num) AS max_total_sale_num
    FROM douyin_top_products dp
    JOIN douyin_top_video dv ON dp.video_basic_id = dv.video_basic_id
    WHERE dv.collect_time BETWEEN '2023-01-01' AND '2023-12-31'  -- 修改为你需要的时间范围
    GROUP BY dp.video_basic_id
) AS max_sales ON dp.video_basic_id = max_sales.video_basic_id AND dv.total_sale_num = max_sales.max_total_sale_num
WHERE dv.industry_id = 10
  AND dv.collect_time BETWEEN '2023-01-01' AND '2023-12-31'  -- 修改为你需要的时间范围
GROUP BY dp.name
ORDER BY max_total_sale_num DESC
LIMIT 20;

```

---


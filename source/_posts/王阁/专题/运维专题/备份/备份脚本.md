```
:#!/bin/bash

date_suffix=$(date +"%Y%m%d%%h%M%s")

archive_dir=/data2/backup
tar -cvf $archive_dir/$1_$date_suffix.tar.gz $2

file_count=$(ls -1 "$archive_dir" | wc -l)

# 如果文件数量大于7，则删除最旧的文件
if [ "$file_count" -gt 7 ]; then
    # 列出归档目录中的所有文件，并按修改时间升序排序
    files_to_delete=($(ls -1t "$archive_dir"))

    # 循环删除多余的文件，只保留最新的七个
    for ((i=${#files_to_delete[@]}-1; i>=7; i--)); do
        file_to_delete="$archive_dir/${files_to_delete[i]}"
        rm "$file_to_delete"
        echo "Deleted: $file_to_delete"
    done
fi
```







```
#!/bin/bash

date_suffix=$(date +"%Y%m%d%%h%M%s")

archive_dir=$1

retain_files=$2

filter_files=$3

file_count=$(ls -1 "$archive_dir"|grep $filter_files| wc -l)

# 如果文件数量大于7，则删除最旧的文件
if [ "$file_count" -gt "$retain_files" ]; then
    # 列出归档目录中的所有文件，并按修改时间升序排序
    files_to_delete=($(ls -1t "$archive_dir" |grep $filter_files))

    # 循环删除多余的文件，只保留最新的七个
    for ((i=${#files_to_delete[@]}-1; i>=$retain_files; i--)); do
        file_to_delete="$archive_dir/${files_to_delete[i]}"
        rm "$file_to_delete"
        echo "Deleted: $file_to_delete"
    done
fi
```

/data2/backup/delete_files

```
bash /data2/backup/delete_files.sh /data2/backup  7 es_
```

